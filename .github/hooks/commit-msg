#!/bin/sh

# Retrieve the commit message
commit_msg_file=$1
commit_msg=$(cat $commit_msg_file)

# Regular expressions for each commit type
feat_regex='^feat(\([a-zA-Z0-9]+\))?!?: .+'
fix_regex='^fix(\([a-zA-Z0-9]+\))?!?: .+'
breaking_change_footer_regex='^BREAKING( |-)CHANGE: .+'
valid_types='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore)(\([a-zA-Z0-9]+\))?!?: .+'

# Verify the commit type
if [[ !($commit_msg =~ $valid_types) ]]; then
    echo "Error: commit message must be valid <type>(<context>): <message>"
    echo "$commit_msg"
    exit 1
fi

# Verify 'feat' or 'fix'
if [[ ($commit_msg =~ $feat_regex) || ($commit_msg =~ $fix_regex) ]]; then
    echo "Commit accepted"
else
    echo "Error: for 'feat' and 'fix' types, a description must follow the ':' and space"
    exit 1
fi

# Verify BREAKING CHANGE in the footer
if [[ $commit_msg =~ $breaking_change_footer_regex ]]; then
    echo "Commit with breaking change detected"
else
    echo "Error: for breaking changes, 'BREAKING CHANGE:' or 'BREAKING-CHANGE:' must be included in the footer"
    exit 1
fi

exit 0